---
import Icon from '@components/ui/Icon.astro';
import { Check, X } from '@lucide/astro';
import type { HTMLTag, Polymorphic } from 'astro/types';
import type { WithChildren } from '../../types.ts';

/**
 * Props for a multi-functional button component.
 *
 * Renders a standard button by default.
 * When a `type` is provided (`radio` or `checkbox`), the component
 * displays the corresponding selection icons and applies the
 * appropriate interactive styles.
 *
 * An input element may be passed into the `input` named slot.
 * When present, its checked state controls the button's visual state.
 * If no input is provided, the component falls back to using the
 * `aria-checked` attribute to determine styling.
 *
 * @template Tag - The HTML tag to render as.
 *
 * @property as - The underlying HTML tag to render. Defaults to `"button"`.
 * @property type - Enables selectable behavior.
 * Can be `"radio"` or `"checkbox"`. When set, checkmark and/or
 * cross icons are rendered automatically.
 * @property children - Default slot content used as the button label.
 */

type Props<Tag extends HTMLTag = HTMLTag> = WithChildren<
	true,
	Polymorphic<{
		as: Tag;
		type?: 'radio' | 'checkbox';
	}>
>;

const { as: Tag = 'button', type, ...restProps } = Astro.props;

const showDisabledIcon = type === 'checkbox';
const showEnabledIcon = showDisabledIcon || type === 'radio';
---

<Tag {...restProps} class="button">
	<slot name="input" />
	{showEnabledIcon && <Icon icon={Check} role="presentation" />}
	{showDisabledIcon && <Icon icon={X} role="presentation" />}
	<span>
		<slot />
	</span>
</Tag>

<style>
	.button {
		display: flex;
		flex-direction: row;
		justify-content: center;
		align-items: center;
		gap: var(--p-sm);
		flex-grow: 1;
		padding: var(--p-sm);
		color: var(--fg);
		white-space: nowrap;
		cursor: pointer;
		transition-duration: var(--d-md);

		background-color: var(--bg-2);
		box-shadow: initial;
		z-index: 1;

		&:has(input:checked),
		&[aria-checked='true'],
		&:hover {
			background-color: var(--bg-3);
			box-shadow: var(--s-box-md);
			z-index: initial;

			> .lucide-check {
				display: initial;
			}

			> .lucide-x {
				display: none;
			}
		}

		&:has(input:not(:checked)),
		&[aria-checked='false'],
		&:active {
			background-color: var(--bg-1);
			box-shadow: initial;
			z-index: initial;

			> .lucide-check {
				display: none;
			}

			> .lucide-x {
				display: initial;
			}
		}
	}

	span {
		display: inline-flex;
		flex-direction: row;
		align-items: center;
		gap: var(--p-xs);
	}

	.lucide-check {
		display: none;
	}

	.lucide-x {
		display: none;
	}
</style>
