---
import HiddenInput from '@components/ui/HiddenInput.astro';
import InputGroup from '@components/ui/InputGroup.astro';
import { OPTION } from '@config/option.ts';
import { getLocale, getLocaleMessages } from '@i18n/index.ts';
import { entriesOf } from '@utils/index.ts';
import type { WithChildren } from '../../types.ts';
import Button from './Button.astro';

/**
 * Props for the options selector component.
 *
 * Explicitly disallows children as option entries are generated from config.
 */
type Props = WithChildren<false>;

const type = 'checkbox' as const;
const currentLocaleId = getLocale(Astro);
const msg = getLocaleMessages(currentLocaleId).options;
---

<InputGroup id={OPTION.id} title={msg.title} role="group">
	{
		entriesOf(OPTION.map).map(([id, { defaultValue }]) => (
			<Button as="label" {type}>
				<HiddenInput
					slot="input"
					name={OPTION.id}
					checked={defaultValue}
					{id}
					{type}
				/>
				{msg.map[id].label}
			</Button>
		))
	}
</InputGroup>

<script>
	import { $option } from '@stores/index.ts';
	import { entriesOf, getDefinedElementById } from '@utils/index.ts';

	for (const [id, store] of entriesOf($option)) {
		const checkbox = getDefinedElementById<HTMLInputElement>(id);

		// Update checkboxes when the option changes
		store.subscribe((value) => {
			checkbox.checked = value;
		});

		// Update theme when a theme radio input is changed
		checkbox.addEventListener('change', () => {
			store.set(checkbox.checked);
		});
	}
</script>
